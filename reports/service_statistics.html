<!DOCTYPE html>
<html lang="en" >
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Service Statistics</title>
		<link href="../CSS/style.css" type="text/css" rel="stylesheet"/>
		<link rel="SHORTCUT ICON" href="../Images/favicon.ico">
		<link href="../CSS/offline_css.css" type="text/css" rel="stylesheet"/>
		<link href="../CSS/jquery-ui.css" type="text/css" rel="stylesheet"/>
		
		<link href="../Scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="../Scripts/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
		
		<script type="text/javascript" src="../Scripts/jquery.js"></script>
		<script type="text/javascript" src="../Scripts/jquery-ui.js"></script>
		<script type="text/javascript" src="../Scripts/offline_database.js"></script>
		<script type="text/javascript" src="../Scripts/offlineData.js"></script>
		<script>
			$(document).ready(function(){
				$.get('reports_include.html', function(data) {
				  $('.result').html(data);
				});
			});
		</script>
		<script type="text/javascript">
			$(document).ready(function() {
				initDatabase();
				//Get the environmental variables to display the hospital name
				selectEnvironmentVariables(function(transaction, results) {
					var $_GET = getQueryParams(document.location.hash);
					var choice_date = $_GET['date'];
					$("#choice_date").val($.datepicker.formatDate('dd-M-yy',new Date(choice_date)));
					// Handle the results
					var row = results.rows.item(0);
					$("#facility_name").text(row['facility_name']);
					var facility = row['facility'];

					//Get the summaries to per service type to display at the top. Start with adults
					var sql_adult_summaries = "select count(*) as total, service, gender,r.name,rg.regimen_desc from patient p  left join regimen_service_type r on p.service = r.id LEFT JOIN regimen rg ON rg.id = p.current_regimen  where (((strftime('%Y', 'now') - strftime('%Y', dob))) >=15 or coalesce((strftime('%Y', 'now') - strftime('%Y', dob)),'x') = 'x') and(date(date_enrolled) <= date('" + choice_date + "') or p.date_enrolled='') and p.facility_code='" + facility + "' group by service, gender,current_regimen";
					//console.log(sql_adult_summaries)
					SQLExecuteAbstraction(sql_adult_summaries, function(transaction, results) {
						var adult_female_art_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var adult_female_pep_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var adult_female_oi_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var adult_female_pmtct_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var adult_male_art_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var adult_male_pep_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var adult_male_oi_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var adult_male_pmtct_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						for(var x = 0; x < results.rows.length; x++) {
							var result_row = results.rows.item(x);
							//start with males
							if(result_row['gender'] == 1 && result_row['name'] == "ART") {
								adult_male_art_string += "<tr><td width='400px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 1 && result_row['name'] == "PEP") {
								adult_male_pep_string += "<tr><td width='400px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 1 && result_row['name'] == "OI Only") {
								adult_male_oi_string += "<tr><td width='400px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							//now females
							if(result_row['gender'] == 2 && result_row['name'] == "ART") {
								adult_female_art_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 2 && result_row['name'] == "PEP") {
								adult_female_pep_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 2 && result_row['name'] == "OI Only") {
								adult_female_oi_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 2 && result_row['name'] == "PMTCT") {
								adult_female_pmtct_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
						}
						$("#adult_female_art").append($(adult_female_art_string));
						$("#adult_female_pep").append($(adult_female_pep_string));
						$("#adult_female_oi").append($(adult_female_oi_string));
						$("#adult_female_pmtct").append($(adult_female_pmtct_string));
						$("#adult_male_art").append($(adult_male_art_string));
						$("#adult_male_pep").append($(adult_male_pep_string));
						$("#adult_male_oi").append($(adult_male_oi_string));
					});
					//Get the summaries to per service type to display at the top. Now for children
					var sql_child_summaries = "select count(*) as total, service, gender,r.name,rg.regimen_desc from patient p  left join regimen_service_type r on p.service = r.id LEFT JOIN regimen rg ON rg.id = p.current_regimen where (((strftime('%Y', 'now') - strftime('%Y', dob))) <15 or coalesce((strftime('%Y', 'now') - strftime('%Y', dob)),'x') = 'x') and(date(date_enrolled) <= date('" + choice_date + "') or date_enrolled='' )and p.facility_code='" + facility + "'group by service, gender,current_regimen";
					//console.log(sql_child_summaries)
					SQLExecuteAbstraction(sql_child_summaries, function(transaction, results) {
						var child_female_art_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var child_female_pep_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var child_female_oi_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var child_female_pmtct_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var child_male_art_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var child_male_pep_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var child_male_oi_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						var child_male_pmtct_string = "<thead><tr><th>Regimen Desc</th><th>Total</th></tr></thead>";
						for(var x = 0; x < results.rows.length; x++) {
							var result_row = results.rows.item(x);
							//start with males
							if(result_row['gender'] == 1 && result_row['name'] == "ART") {
								child_male_art_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 1 && result_row['name'] == "PEP") {
								child_male_pep_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 1 && result_row['name'] == "OI Only") {
								child_male_oi_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 1 && result_row['name'] == "PMTCT") {
								child_male_pmtct_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							//now females
							if(result_row['gender'] == 2 && result_row['name'] == "ART") {
								child_female_art_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 2 && result_row['name'] == "PEP") {
								child_female_pep_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 2 && result_row['name'] == "OI Only") {
								child_female_oi_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
							if(result_row['gender'] == 2 && result_row['name'] == "PMTCT") {
								child_female_pmtct_string += "<tr><td width='300px'>" + result_row['regimen_desc'] + "</td><td>" + result_row['total'] + "</td></tr>";

							}
						}
						$("#child_female_art").append($(child_female_art_string));
						$("#child_female_pep").append($(child_female_pep_string));
						$("#child_female_oi").append($(child_female_oi_string));
						$("#child_female_pmtct").append($(child_female_pmtct_string));
						$("#child_male_art").append($(child_male_art_string));
						$("#child_male_pep").append($(child_male_pep_string));
						$("#child_male_oi").append($(child_male_oi_string));
						$("#child_male_pmtct").append($(child_male_pmtct_string));

					});
				});
				
				$("#choice_date").datepicker({
					changeMonth : true,
					changeYear : true,
					dateFormat : 'yy-mm-dd'
				});
				$("#choice_date").change(function(){
					var selected_date = $("#choice_date").attr("value");
					var report_url = "service_statistics.html#?date=" + selected_date;
					window.location = report_url;
					location.reload();
				});
				
			});
			function getAge(dateString) {
				var today = new Date();
				var birthDate = new Date(dateString);
				var age = today.getFullYear() - birthDate.getFullYear();
				var m = today.getMonth() - birthDate.getMonth();
				if(m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
					age--;
				}
				if(isNaN(age)) {
					return "N/A";
				}
				return age;
			}
		</script>
	</head>
	<body>
		<style>
		#top_enrollments_panel{
			margin-top:20px;
		}
			
			#patient_listing td th {
				padding: 10px;
			}
			#top_enrollments_panel {
				width: 1200px;
				margin: 0 auto;
			}
			
			#choice_date{
				color: rgb(45, 173, 13);
				font-size:14px;
				border:none;
				font-weight: 800;
				width:110px;
				padding-bottom:0px;
				height:25px;
			}
			#choice_date:hover{
				cursor:pointer;
			}
			table.table_content{
				border:1px solid #000;
			}
			.table{
				margin-bottom: 0px;
				border-radius: 0px;
				font-size:12px;
				
			}
			.table th{
				font-size:14px;
			}
			.table_content td{
				vertical-align: top;
			}
			.title_head{
				background-color: rgb(192, 192, 192);
			}
			.table th, .table td{
				padding:4px;
			}
			div.category_title{
				font-size:18px;
				text-transform:uppercase;
				width:1198px;
				padding-top:6px;
				padding-bottom:6px;
				font-weight:bolder;
				text-align:center;
			}
			div.sub_category_title{
				font-size:16px;
				text-transform:uppercase;
				width:1198px;
				text-align:center;
				border:1px solid #000;
				padding-top:6px;
				padding-bottom:6px;
			}
			div.sub_category_title{
				background-color:#CFF;
			}
		</style>
		
		<!-- Menus -->
		<div class="navbar ">
		  <div class="navbar-inner">
		    <div class="container">
		 
		      <!-- Everything you want hidden at 940px or less, place within here -->
		      <div class="nav-collapse collapse" id="acdmenu">
		      	<a class="brand" href="../reports.html"/><img src="../Images/home-icon.png"> | </a>
		        <ul class="nav">
				  <li class="dropdown">
				    <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="standard_report">
				     Standard Reports
				    <b class="caret"></b>
				    </a>
				    <ul class="dropdown-menu" id="standard_report_sub">
				      <li><a href="#" id="patients_enrolled_in_period" class="report donor_date_range_report active_report">Number of Patients Enrolled in Period</a></li>
				      <li><a href="#" id="patients_enrolled_in_art" class="report donor_date_range_report active_report">Number of Patients Started on ART in the Period</a></li>
				      <li><a href="#" id="graph_patients_enrolled_in_year" class="report active_report annual_report">Graph of Number of Patients Enrolled Per Month in a Given Year</a></li>
				      <li><a href="#" id="cumulative_patients" class="report active_report single_date_report">Cumulative Number of Patients to Date</a></li>
				      <li><a href="#" id="patients_on_ART_active" class="report active_report single_date_report">Number of Active Patients Receiving ART (by Regimen)</a></li>
				    </ul>
				  </li>
				  <li class="dropdown divider-vertical" id="visiting_patient">
				    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
				     Visiting Patients
				    <b class="caret"></b>
				    </a>
				     <ul class="dropdown-menu" id="visiting_patient_sub">
				      <li><a href="#" id="patients_scheduled_to_visit" class="report active_report date_range_report">List of Patients Scheduled to Visit</a></li>
				      <li><a href="#" id="patients_started_on_date" class="report active_report date_range_report">List of Patients Started (on a Particular Date)</a></li>
				      <li><a href="#" id="patients_visitied_for_refill" class="report active_report date_range_report">List of Patients Visited for Refill</a></li>
				      <li><a href="#" id="patients_missing_appointments" class="report active_report date_range_report">Patients Missing Appointments</a></li>
				      <li><a href="#" id="patients_adherence" class="report active_report date_range_report">Patients Adherence Report</a></li>
				    </ul>
				  </li>
				  <li class="dropdown divider-vertical">
				    <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="early_warning">
				     Early Warning Indicators
				    <b class="caret"></b>
				    </a>
				    <ul class="dropdown-menu " id="early_warning_sub">
				      <li><a href="#" id="patients_who_changed_regimen" class="report active_report date_range_report">Active Patients who Have Changed Regimens</a></li>
				      <li><a href="#" id="patients_starting" class="report active_report date_range_report">List of Patients Starting (By Regimen)</a></li>
				      <li><a href="#" id="early_warning_indicators" class="report active_report date_range_report">HIV Early Warning Indicators</a></li>
				      <li><a href="#" id="service_statistics" class="report active_report single_date_report">Service Statistics (By Regimen)</a></li>
				     
				    </ul>
				  </li>
				  <li class="dropdown divider-vertical">
				    <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="drug_inventory">
				     Drug Inventory
				    <b class="caret"></b>
				    </a>
				    <ul class="dropdown-menu" id="drug_inventory_sub">
				      <li><a href="#" id="drug_consumption" class="report active_report annual_report">Drug Consumption Report</a></li>
				      <li><a href="#" id="drug_stock_on_hand" class="report active_report no_filter">Drug Stock on Hand Report</a></li>
				      <li><a href="#" id="commodity_summary" class="report active_report date_range_report">Facility Summary Commodity Report</a></li>
				      <li><a href="#" id="expiring_drugs" class="report active_report no_filter">Short Dated Stocks &lt;6 Months to Expiry</a></li>
				      <li><a href="#" id="expired_drugs" class="report active_report no_filter">List of Expired Drugs</a></li>
				    </ul>
				  </li>
				</ul>
		        
		      </div>
		 
		    </div>
		  </div>
		</div>
		<!-- Menus end -->
		
		<h2 id="facility_name" style="text-align: center"></h2>
		<h4 style="text-align: center">Service Statistics By Regimen on <input type="text" class="_date" id="choice_date">
			<br><br> AllDonors
		</h4>
		<hr size="1" style="width:80%">
		<br>
		
		<div id="top_enrollments_panel">
			<div id="adult_enrollments" class="category">
				<div class="category_title">
					Adults
				</div>
				<div id="adult_male_enrollments" class="sub_category">
					<div class="sub_category_title">
						Male
					</div>
					<table class="table_content" align='center' width='100%'  border='1'  cellspacing="0" cellpadding="0">
						<thead class="title_head">
							<tr>
								<th>ART</th>
								<th>PEP</th>
								<th>OI</th>
							</tr>
						</thead>
						
						<tr>
							<td><table class="table table-striped"  id="adult_male_art"></table></td>
							<td><table class="table table-striped"  id="adult_male_pep"></table></td>
							<td><table class="table table-striped"  id="adult_male_oi"></table></td>
						</tr>
					</table>
				</div>
				<div id="adult_female_enrollments" class="sub_category">
					<div class="sub_category_title">
						Female
					</div>
					<table class="table_content" align='center'  width='100%' border='1'  cellspacing="0" cellpadding="0">
						<thead class="title_head">
							<tr>
								<th>ART</th>
								<th>PEP</th>
								<th>PMTCT</th>
								<th>OI</th>
							</tr>
						</thead>
						
						<tr>
							<td><table class="table table-striped"  id="adult_female_art"></table></td>
							<td><table class="table table-striped" id="adult_female_pep"></table></td>
							<td><table class="table table-striped" id="adult_female_pmtct"></table></td>
							<td><table class="table table-striped" id="adult_female_oi"></table></td>
						</tr>
					</table>
				</div>
			</div>
			<div id="child_enrollments" class="category">
				<div class="category_title">
					Children
				</div>
				<div id="child_male_enrollments" class="sub_category">
					<div class="sub_category_title">
						Male
					</div>
					<table class="table_content" align='center' width='100%' border='1' cellspacing="0" cellpadding="0">
						<thead class="title_head">
							<tr>
								<th>ART</th>
								<th>PEP</th>
								<th>PMTCT</th>
								<th>OI</th>
							</tr>
						</thead>
						<tr>
							<td><table class="table table-striped"  id="child_male_art"></table></td>
							<td><table class="table table-striped"  id="child_male_pep"></table></td>
							<td><table class="table table-striped"  id="child_male_pmtct"></table></td>
							<td><table class="table table-striped"  id="child_male_oi"></table></td>
						</tr>
					</table>
				</div>
				<div id="child_female_enrollments" class="sub_category">
					<div class="sub_category_title">
						Female
					</div>
					<table class="table_content" align='center' width='100%' border='1' cellspacing="0" cellpadding="0">
						<thead class="title_head">
							<tr>
								<th>ART</th>
								<th>PEP</th>
								<th>PMTCT</th>
								<th>OI</th>
							</tr>
						</thead>
						<tr>
							<td><table class="table table-striped"  id="child_female_art"></table></td>
							<td><table class="table table-striped"  id="child_female_pep"></table></td>
							<td><table class="table table-striped"  id="child_female_pmtct"></table></td>
							<td><table class="table table-striped"  id="child_female_oi"></table></td>
						</tr>
					</table>
				</div>
			</div>
			<p>&nbsp;</p>
		</div>
		
		<!-- Pop up Window -->
		<div class="result"></div>
		<!-- Pop up Window end-->
	</body>
</html>